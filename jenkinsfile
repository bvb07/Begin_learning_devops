
pipeline {
    agent any
    environment{
        TEST_URL = 'https://images.unsplash.com/photo-1673234759103-4bc13ee175d0?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=987&q=80'
        CLOUDSDK_AUTH_CREDENTIAL_FILE_OVERRIDE = '' 
    
    }
    stages {
        stage('Init'){
            steps{
                sh '''
                cd compose
                pwd
                docker --version
                ls -a
            
                '''
                echo 'Init'
                echo '******************************'  
                echo "registry url : ${env.TEST_URL}"
               
                echo '*************************************************'
            }
          }
        stage('build'){
            steps{
                sh '''
                cd compose
                docker-compose up -d
                pwd
                '''
                echo '*************************************************'
              }
          }
        stage('stop end'){
            steps{
                sh '''
                cd compose
                docker-compose down
                pwd
                node -v
                cd ..
                cd kube
                
                sudo apt-get install apt-transport-https ca-certificates gnupg
                echo "deb https://packages.cloud.google.com/apt cloud-sdk main" | sudo tee -a /etc/apt/sources.list.d/google-cloud-sdk.list
                curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -
                sudo apt-get update && sudo apt-get install google-cloud-cli
                RUN echo "deb [signed-by=/usr/share/keyrings/cloud.google.gpg] http://packages.cloud.google.com/apt cloud-sdk main" | tee -a /etc/apt/sources.list.d/google-cloud-sdk.list && curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | tee /usr/share/keyrings/cloud.google.gpg && apt-get update -y && apt-get install google-cloud-sdk -y
     
                gcloud container clusters get-credentials trainee --zone asia-east1-a --project customix
                
                kubectl get pods 
                kubectl get service 
                kubectl get ingrese
                '''
                
                echo '*************************************************'
           }
        }
       


        
    }
}
